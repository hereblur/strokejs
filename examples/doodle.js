$(document).ready(function(){
  var hiraganaA = [
          [[67,101], [428,102]],
            [[190,25],[193,409]],
            [[329,215],[206,391],[111,409],[56,353],[104,240],[264,187],[384,217],[443,307],[422,377],[304,437]]
          ] ;

  var handwrite = [
                [[76,99],[77,99],[79,99],[81,99],[84,99],[87,99],[91,99],[94,99],[99,99],[104,99],[110,99],[115,99],[122,99],[127,99],[134,99],[142,99],[149,99],[156,99],[166,99],[175,99],[187,99],[200,99],[212,99],[226,99],[241,99],[255,99],[277,99],[287,99],[297,99],[319,99],[331,99],[340,99],[358,99],[364,99],[372,99],[380,99],[383,99],[386,99],[387,99],[391,99],[392,99],[394,99],[397,99],[399,99],[402,99],[403,99],[407,99],[409,99],[411,99],[413,99],[416,99],[417,99],[419,99],[421,99],[422,99],[423,99]],
                   [[197,33],[197,35],[195,39],[192,44],[191,48],[188,54],[186,63],[185,71],[181,78],[180,89],[176,99],[173,108],[171,118],[169,131],[169,141],[169,153],[169,163],[167,173],[166,184],[164,192],[164,201],[164,208],[164,217],[164,226],[164,235],[164,243],[164,253],[164,263],[166,273],[166,283],[166,293],[170,302],[173,310],[176,317],[177,323],[180,329],[182,333],[184,337],[186,341],[186,343],[190,348],[191,349],[193,351],[194,354],[195,355],[196,356],[197,357]],
                   [[326,216],[323,219],[322,220],[321,223],[320,224],[318,226],[317,228],[316,229],[315,231],[313,234],[311,236],[310,238],[307,242],[306,244],[303,248],[302,250],[300,254],[297,259],[295,263],[293,267],[290,271],[286,276],[283,281],[279,286],[276,290],[271,295],[268,299],[264,304],[261,308],[258,313],[255,316],[252,323],[249,326],[247,330],[243,334],[241,336],[237,340],[234,343],[232,346],[229,351],[227,354],[222,359],[220,361],[217,365],[214,367],[211,369],[210,370],[206,373],[203,374],[200,377],[198,379],[195,381],[194,381],[190,382],[188,384],[184,385],[182,385],[180,385],[176,385],[171,386],[166,386],[161,386],[155,386],[151,386],[147,386],[144,386],[140,386],[138,385],[132,381],[131,380],[127,377],[125,376],[122,374],[121,372],[120,371],[120,367],[116,364],[115,361],[115,358],[114,355],[114,350],[112,345],[112,341],[112,335],[112,330],[112,325],[112,321],[112,316],[112,312],[114,306],[114,303],[117,299],[119,295],[121,290],[126,284],[129,279],[133,275],[137,269],[140,265],[148,261],[154,256],[161,253],[168,249],[176,243],[186,239],[194,237],[202,233],[210,230],[221,226],[228,223],[238,220],[245,219],[255,216],[259,216],[268,212],[275,212],[281,212],[288,212],[295,212],[301,212],[308,212],[313,212],[321,214],[328,215],[336,219],[343,221],[350,223],[358,226],[364,228],[374,232],[381,235],[391,240],[398,243],[404,247],[411,250],[418,255],[422,259],[427,263],[432,269],[436,276],[441,283],[447,291],[450,300],[452,306],[454,314],[455,322],[455,330],[455,340],[455,347],[455,353],[455,360],[455,364],[455,371],[451,376],[451,381],[449,384],[448,388],[444,391],[442,394],[438,399],[434,402],[430,406],[421,411],[413,413],[401,413],[386,418],[373,418],[360,420],[345,421],[328,421],[314,421],[299,421],[283,421],[268,421],[256,421],[242,421],[232,421],[224,421],[215,421],[214,421],[211,421]]
                 ];
  handwrite = JSON.parse(JSON.stringify(hiraganaA));
  handwrite[0][0][1] += 000;

  window.Canvas.init()
  var doodle = new strokejs.Doodle(handwrite);
  var stroke = new strokejs.Stroke([]);
  var teacher= new strokejs.Doodle(hiraganaA);
  var render = function(){
    window.Canvas.clear()

    _.each(hiraganaA, function(strk){
      window.Canvas.path(strk.map(function(p){ return {x:p[0], y:p[1]};}), 50, "#efefef");
    })

    _.each(doodle.strokes(), function(strk){
      window.Canvas.path(strk.points(), 3, "#777777");
    })

    window.Canvas.path(stroke.points(), 3, "#000000");

    var sections = null;
    diff = teacher.compare(doodle);

    var text = "Compare result: " + diff + " points\n<H1>" +(diff<2?"NOTPASS":"PASS") +"</H1>";
    $("#output").html(text);
  }

  render();

  var drawing = false;

  $("#clear").click(function(){
      doodle = new strokejs.Doodle([]);
      stroke = new strokejs.Stroke([]);
      render();
  })

  $("canvas:first")
  .mousedown(function(e){
      drawing = true;
      stroke.append([e.offsetX, e.offsetY])
      render();
  })
  .mousemove(function(e){
     if(drawing){
      stroke.append([e.offsetX, e.offsetY])
      render();
    }
  })
  .mouseup(function(e){
    if(drawing){
      drawing = false;
      stroke.append([e.offsetX, e.offsetY])
      doodle.append(stroke);
      stroke = new strokejs.Stroke([]);
      render();
    }
  });

});
